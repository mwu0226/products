<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品展示</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .product { border: 1px solid #ddd; padding: 10px; margin: 10px; display: inline-block; width: 200px; vertical-align: top; }
        .carousel img { width: 100%; display: none; }
        .carousel img.active { display: block; }
        .carousel-btn { cursor: pointer; }
        .category { font-size: 20px; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>产品展示</h1>
    <input type="text" id="searchBox" placeholder="搜索产品..." onkeyup="searchProducts()">
    <div id="productList"></div>

    <script>
        let productsData = [];

        async function fetchProducts() {
            const response = await fetch("https://api.github.com/repos/你的用户名/my-products/issues");
            const issues = await response.json();

            productsData = issues.map(issue => {
                const body = issue.body;
                const nameMatch = body.match(/\*\*名称\*\*: (.+)/);
                const priceMatch = body.match(/\*\*价格\*\*: (.+)/);
                const categoryMatch = body.match(/\*\*分类\*\*: (.+)/);
                const images = (issue.body.match(/!\[.*?\]\((.*?)\)/g) || []).map(img => img.match(/\((.*?)\)/)[1]);

                return {
                    name: nameMatch ? nameMatch[1] : "未知产品",
                    price: priceMatch ? priceMatch[1] : "价格未定",
                    category: categoryMatch ? categoryMatch[1] : "未分类",
                    images: images
                };
            });

            renderProducts(productsData);
        }

        function renderProducts(products) {
            let productList = document.getElementById("productList");
            productList.innerHTML = "";

            let categories = {}; // 用于存储按分类分组的产品

            products.forEach((product, index) => {
                if (!categories[product.category]) {
                    categories[product.category] = [];
                }
                categories[product.category].push({ product, index });
            });

            Object.keys(categories).forEach(category => {
                let categoryDiv = document.createElement("div");
                categoryDiv.className = "category";
                categoryDiv.innerText = category;
                productList.appendChild(categoryDiv);

                categories[category].forEach(({ product, index }) => {
                    let div = document.createElement("div");
                    div.className = "product";
                    div.setAttribute("data-name", product.name);
                    div.setAttribute("data-category", product.category);

                    let imgHtml = product.images.map((img, idx) => 
                        `<img src="${img}" class="${idx === 0 ? 'active' : ''}">`).join("");

                    div.innerHTML = `
                        <h3>${product.name}</h3>
                        <p>价格: ${product.price}</p>
                        <p>分类: ${product.category}</p>
                        <div class="carousel" id="carousel-${index}">
                            ${imgHtml}
                            <button class="carousel-btn prev" onclick="prevImage(${index})">◀</button>
                            <button class="carousel-btn next" onclick="nextImage(${index})">▶</button>
                        </div>
                    `;
                    productList.appendChild(div);
                });
            });
        }

        function searchProducts() {
            let query = document.getElementById("searchBox").value.toLowerCase();
            let filteredProducts = productsData.filter(product =>
                product.name.toLowerCase().includes(query) ||
                product.category.toLowerCase().includes(query)
            );
            renderProducts(filteredProducts);
        }

        function prevImage(index) {
            let images = document.querySelectorAll(`#carousel-${index} img`);
            let activeIndex = [...images].findIndex(img => img.classList.contains('active'));
            images[activeIndex].classList.remove('active');
            images[(activeIndex - 1 + images.length) % images.length].classList.add('active');
        }

        function nextImage(index) {
            let images = document.querySelectorAll(`#carousel-${index} img`);
            let activeIndex = [...images].findIndex(img => img.classList.contains('active'));
            images[activeIndex].classList.remove('active');
            images[(activeIndex + 1) % images.length].classList.add('active');
        }

        fetchProducts();
    </script>
</body>
</html>
